<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vitoria</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</head>
<style>
    body {
           font-family: Arial, sans-serif;
           background-color: white; /* Cor de fundo branca */
           color: #000000; /* Cor do texto preto */
       }
       .container {
           max-width: 600px;
           background-color: #22648B; /* Azul #22648B */
           margin: 50px auto;
           padding: 20px;
           border: 1px solid #ccc;
           border-radius: 5px;
           overflow: hidden; /* Impede que o conteúdo ultrapasse as bordas do formulário */
       }
       textarea {
           width: calc(100% - 22px); /* Leva em consideração o padding de 10px */
           height: 100px;
           margin-bottom: 10px;
           padding: 10px;
           border: 1px solid #ccc;
           border-radius: 5px;
           overflow-y: auto; /* Adiciona barra de rolagem vertical se o texto exceder a altura do campo */
           word-wrap: break-word; /* Quebra as palavras que excedem a largura do campo */
       }
       button {
           padding: 10px 20px;
           background-color: #22648B; /* Azul #22648B */
           color: #ffffff; /* Texto branco */
           border: none;
           border-radius: 5px;
           cursor: pointer;
           margin-right: 10px;
       }
       #anotacoes {
           margin-top: 20px;
           padding: 10px;
           border: 1px solid #ccc;
           border-radius: 5px;
       }
       .nota {
           margin-bottom: 10px;
           background-color: #B8F0DF; /* Verde #B8F0DF */
           padding: 10px;
           border-radius: 5px;
       }
       .nota-button {
           padding: 5px 10px; /* Ajuste do padding */
           background-color: #22648B; /* Azul #22648B */
           color: #ffffff; /* Texto branco */
           border: none;
           border-radius: 3px;
           cursor: pointer;
           margin-right: 5px;
           font-size: 12px; /* Ajuste do tamanho da fonte */
       }
       .btn-primary{
         background-color: #22648B;
       }
       .btn-primary:hover{
         background-color: #B8F0DF;
       }
</style>
<body>
<header>
    <a class="btn btn-primary" href="#" role="button" onclick="confirmarVoltar()">Voltar</a>
</header>
<div class="container mt-5">
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">Abrir Modal de Anotações</button>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Nova Anotação</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="form-anotacoes">
          <div class="mb-3">
            <label for="data" class="col-form-label">Data:</label>
            <input type="date" class="form-control" id="data" required>
          </div>
          <div class="mb-3">
            <label for="anotacao" class="col-form-label">Anotação:</label>
            <textarea class="form-control" id="anotacao" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-primary" onclick="salvarAnotacao()">Salvar</button>
      </div>
    </div>
  </div>
</div>
<button onclick="salvarBackup()">Fazer Backup</button>
<script>
// Função para carregar as anotações salvas no armazenamento local
window.onload = function() {
    var anotacoes = JSON.parse(localStorage.getItem("anotacoes"));
    if (anotacoes) {
        anotacoes.forEach(function(anotacao) {
            adicionarAnotacao(anotacao.data, anotacao.texto);
        });
    }
};

// Função para salvar uma nova anotação
function salvarAnotacao() {
    var data = document.getElementById("data").value;
    var anotacao = document.getElementById("anotacao").value;
    
    // Adiciona a nova anotação ao armazenamento local
    var anotacoes = JSON.parse(localStorage.getItem("anotacoes")) || [];
    anotacoes.push({ data: data, texto: anotacao });
    localStorage.setItem("anotacoes", JSON.stringify(anotacoes));
    
    // Adiciona a nova anotação à página
    adicionarAnotacao(data, anotacao);

    // Limpa o formulário
    document.getElementById("form-anotacoes").reset();

    // Fecha o modal
    var modal = bootstrap.Modal.getInstance(document.getElementById("exampleModal"));
    modal.hide();
}

// Função para adicionar uma anotação à página
function adicionarAnotacao(data, anotacao) {
    // Criação do botão com a data como título
    var novoBotao = document.createElement("button");
    novoBotao.type = "button";
    novoBotao.className = "btn btn-primary m-2";
    novoBotao.textContent = data;
    novoBotao.setAttribute("data-bs-toggle", "modal");
    novoBotao.setAttribute("data-bs-target", "#anotacaoModal");

    // Adiciona um evento para exibir a anotação no modal ao clicar no botão
    novoBotao.addEventListener("click", function() {
        document.getElementById("anotacaoTitulo").textContent = data;
        document.getElementById("anotacaoConteudo").textContent = anotacao;
    });

    // Criação do botão de exclusão
    var botaoExcluir = document.createElement("button");
    botaoExcluir.type = "button";
    botaoExcluir.className = "btn btn-danger btn-sm m-2";
    botaoExcluir.textContent = "Excluir";
    botaoExcluir.addEventListener("click", function() {
        novoBotao.remove();
        // Remove a anotação do armazenamento local
        var anotacoes = JSON.parse(localStorage.getItem("anotacoes"));
        anotacoes = anotacoes.filter(function(item) {
            return item.data !== data || item.texto !== anotacao;
        });
        localStorage.setItem("anotacoes", JSON.stringify(anotacoes));
    });

    // Adiciona o novo botão à página
    document.getElementById("anotacoes").appendChild(novoBotao);
    novoBotao.appendChild(botaoExcluir);
}
// Função para salvar os dados do localStorage em um arquivo local
function salvarBackup() {
    // Obter os dados do localStorage
    var dados = localStorage.getItem("anotacoes");

    // Verificar se há dados a serem salvos
    if (dados) {
        // Converter os dados para o formato desejado (por exemplo, JSON)
        var dadosFormatados = JSON.stringify(dados);

        // Criar um novo objeto Blob com os dados formatados
        var blob = new Blob([dadosFormatados], { type: "application/json" });

        // Criar um link de download para o Blob
        var url = URL.createObjectURL(blob);

        // Criar um elemento <a> para iniciar o download
        var link = document.createElement("a");
        link.href = url;
        link.download = "backup_anotacoes.json";

        // Simular um clique no link para iniciar o download
        link.click();

        // Liberar a URL do objeto Blob
        URL.revokeObjectURL(url);
    } else {
        console.log("Nenhuma anotação para fazer backup.");
    }
}

// Função para confirmar se deseja voltar com ou sem backup
function confirmarVoltar() {
    var confirmacao = confirm("Deseja salvar o backup antes de sair?");
    if (confirmacao) {
        salvarBackup();
        // Após salvar o backup, redirecionar para a página "pi.html"
        window.location.href = "pi.html";
    } else {
        // Se não deseja salvar o backup, apenas redirecionar para a página "pi.html"
        window.location.href = "pi.html";
    }
}

</script>


<!-- Modal de Visualização de Anotação -->
<div class="modal fade" id="anotacaoModal" tabindex="-1" aria-labelledby="anotacaoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="anotacaoTitulo"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="anotacaoConteudo"></div>
    </div>
  </div>
</div>

<div id="anotacoes" class="container mt-3">
  <!-- Aqui serão inseridos os botões de anotação -->
</div>

</body>
</html>
